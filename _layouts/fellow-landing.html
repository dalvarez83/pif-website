---
layout: default
---

<div class="usa-hero usa-hero--short">
  <div class="usa-hero__overlay"></div>
  <div class="usa-hero__overlay-content">
    <div class="grid-container display-flex flex-column flex-justify-center height-full">
      <h1 class="usa-hero__heading display display--inverted">
        Fellows
      </h1>
    </div>
  </div>
</div>

<section class="padding-top-4 padding-bottom-1 bg--lightest">
  <div class="grid-container">
    <div class="grid-row usa-prose">
      <p class="body-intro">
        We're building human-centered solutions that scale, and<br class="display-none tablet:display-inline" />
        fundamentally changing federal culture while we're at it.
        <br/>
        Learn about some of our projects below.
      </p>
    </div>
    <div class="grid-row margin-top-4">
      {% include_cached fellow-filters.html %}
    </div>
  </div>
</section>

<section class="grid-container usa-layout-docs usa-section">
  <div class="grid-row grid-gap">
    <div class="usa-layout-docs__main usa-prose list-fellows">
      <main id="main-content">
        <!-- initial list that the search results replace -->
        <span id='fellow-search-default'>
          {{ content }}
        </span>
        <!-- search results container -->
        <span id='fellow-search-results' class="grid-row">
        </span>
      </main>
    </div>
  </div>
</section>

{% include_cached quote.html image="quotes/jacqueline_kazil.jpg" quote="PIFdom is about having the opportunity to have an impact on every American." name="Jacqueline  Kazil, 2013 PIF, detailed to the Federal Emergency Management Agency (FEMA)" %}

<!-- vendor search script -->
{% asset simple_jekyll_search.js %}

<!-- search -->
<script type="text/javascript">
function fakeSlugify (str) {
    str = str.replace(/^\s+|\s+$/g, ''); // trim
    str = str.toLowerCase();
    str = str.replace(/\s+/g, '-') // collapse whitespace and replace by -
        .replace(/-+/g, '-'); // collapse dashes
    return str;
}
  var searchbox = document.getElementById('fellows-search-input');
  var searchInput = document.getElementById('fellows-search-input'); // Found in fellow-filters.html
  var resultsContainer = document.getElementById('fellow-search-results');
  var fellowsJson = [{% for fellow in site.fellows %}
        {
          "title"    : "{{ fellow.title | escape }}",
          "category" : "{{ fellow.category }}",
          "tags"     : "{{ fellow.agency | join: ', ' }}",
          "url"      : "{{ site.baseurl }}{{ fellow.url }}",
          "date"     : "{{ fellow.date }}",
          "content"  : "{{ fellow.bio_short | strip_html | strip_newlines | remove_chars | escape }}",
          "image_path" : "{% asset '{{ fellow.image }}' @path %}",
          "specialty" : "{{ fellow.skills | first | escape }}",
          "linkedin": "<span class='fellow-card--linkedin'>{% if fellow.linkedin %}<a href={{ fellow.linkedin }}><img src={% asset 'icons/linkedin-blue.svg' @path %} alt='{{ fellow.title}} on LinkedIn'/></a>{% else %}''{% endif %}</span>",
          "twitter": "<span class='fellow-card--twitter'>{% if fellow.twitter %}<a href={{ fellow.twitter }}><img src={% asset 'icons/twitter.svg' @path %} alt='{{ fellow.title }} on Twitter' /></a>{% else %}''{% endif %}</span>",
          "fellow_year": "{{ fellow.fellow_year }}"
        } {% unless forloop.last %},{% endunless %}
      {% endfor %}];
  /***
    - Search Result Template markup should match items in fellow-list.html
    - Any fellow content needed for template should be added to json above.
    - Template syntax: https://github.com/christian-fei/Simple-Jekyll-Search/wiki#searchresulttemplate-string-optional
  ***/
  var searchResultTemplate = '<div class="fellow-card desktop:grid-col-3 tablet:grid-col-6"><a href="{url}"><div class="usa-prose fellow-img"><img src="{image_path}" class="circle-card" alt="{title}"/></div><div><h2 class="body-intro--bold">{title}</h2><p class="fellow-card--specialty">{specialty}</p><p class="content">{content}</p></a><p><span class="fellow-card--fellow-year">{fellow_year}</span>{linkedin}{twitter}</p></div></div>';
  var searchInputDummy = {addEventListener: () => {}};
  var sjs = SimpleJekyllSearch({
    searchInput: searchInputDummy,
    resultsContainer: resultsContainer,
    json: fellowsJson,
    searchResultTemplate: searchResultTemplate
  });
  var inFellowSearch = false;
  var defaultList = document.getElementById("fellow-search-default");
    
  var yearSelect = document.getElementById("fellows-select-year");
  var skillSelect = document.getElementById("fellows-select-skill");

  resetFilters= () => {
    yearSelect.value="";
    skillSelect.value="";
    window.history.replaceState({}, '', "{{site.baseurl}}/fellows"); 
  };
  
  searchbox.addEventListener('focus', () => {
    sjs = SimpleJekyllSearch({
      searchInput: searchInput,
      resultsContainer: resultsContainer,
      json: fellowsJson,
      searchResultTemplate: searchResultTemplate
    });
    resetFilters();
  });

  /*** show initial list after search is over ***/
  searchbox.addEventListener('keyup', function() {
    if (searchInput.value.trim().length && !inFellowSearch) {
      sjs.search(searchInput.value.trim());
      inFellowSearch = true;
      defaultList.style.display = "none";
    }
    if (!searchInput.value.trim().length && inFellowSearch) {
      inFellowSearch = false;
      defaultList.style.display = "block";
    }
  });
  
  // wwe need to track both the filters by way of the URL so that if someone shares the path, we can render the right results
  const buildPath = () => {
    const base = "{{site.baseurl}}/fellows";
    const subpage = yearSelect.value ? `/${yearSelect.value}` : ''; // years are rendered as pages because fellows are a Jekyll collection (defined in config.yml)
    const querystring = skillSelect.value ? `?specialty=${fakeSlugify(skillSelect.value)}` : '';
    return base + subpage + querystring;
  };
  
  // get year from pathname
  var curYearMatch = window.location.pathname.match(/([\d])\w+/g);
  if (curYearMatch) yearSelect.value = curYearMatch[0];

  yearSelect.addEventListener('change', (e) => {
    if (e.target.value) {
      let json = fellowsJson.filter(fellow => fellow.fellow_year === e.target.value);
      if (skillSelect.value) {
        json = json.filter(fellow => fellow.specialty === skillSelect.value);
      }
      sjs = SimpleJekyllSearch({
        searchInput:  searchInputDummy,
        resultsContainer: resultsContainer,
        json: json,
        searchResultTemplate: searchResultTemplate
      });
      console.log(json);
      sjs.search(e.target.value);
      window.history.replaceState({}, '', buildPath());
      defaultList.style.display = "none";
    } else {
      defaultList.style.display = "block";
    }
  })
  
  /*** respond to fellow skill dropdown ***/
  skillSelect.addEventListener('change', function(e) {
    if (e.target.value) {
      let json = fellowsJson.filter(fellow => fellow.specialty === e.target.value);
      if (yearSelect.value) {
        json = json.filter(fellow => fellow.fellow_year === yearSelect.value);
      }
      sjs = SimpleJekyllSearch({
        searchInput:  searchInputDummy,
        resultsContainer: resultsContainer,
        json: json,
        searchResultTemplate: searchResultTemplate
      });
      console.log(json);
      sjs.search(e.target.value);
      // reset the fellows year filter when skill is chosen
      // yearSelect.value = "";
      window.history.replaceState({}, '', buildPath());
      defaultList.style.display = "none";
    } else {
      defaultList.style.display = "block";
    }
  });
</script>
